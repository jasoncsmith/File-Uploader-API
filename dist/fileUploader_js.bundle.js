"use strict";(self.webpackChunkappLaunch=self.webpackChunkappLaunch||[]).push([[613],{939:function(e,t,i){i.r(t),i.d(t,{default:function(){return b}});var n=i(785),a=i(861),l=i(942),s=i(144),r=i(671),o=i(687),u=i.n(o),c=i(96);function h(e){var t;for(t=0;e>=1024&&t<4;t++)e/=1024;return"".concat(e.toFixed(1)).concat(["B","KB","MB","GB","TB"][t])}var f=i(856),d=i.n(f),p=i(527),g=[],v=0,F=(0,s.Z)((function e(t){(0,r.Z)(this,e),this.filename=t.name,this.totalfilesize=t.size,this.file=t})),m=(0,s.Z)((function e(t){(0,r.Z)(this,e),this.fileName=t.name,this.src=null,this.size=h(t.size)})),y=function(){function e(){var t=this;(0,r.Z)(this,e),(0,l.Z)(this,"kp",p.postbox),(0,l.Z)(this,"elDropArea",null),(0,l.Z)(this,"elFileInput",null),(0,l.Z)(this,"queuedFileTransfers",[]),(0,l.Z)(this,"allowedFileTypes","*"),(0,l.Z)(this,"configApi",null),(0,l.Z)(this,"configMultiple",!1),(0,l.Z)(this,"configValidateContent",!1),(0,l.Z)(this,"configMaxFileSize",null),(0,l.Z)(this,"configAllowedFileExtensions",[]),(0,l.Z)(this,"fileListItems",p.observableArray([])),(0,l.Z)(this,"isFileReadyForUpload",p.observable(!1).extend({notify:"always"})),(0,l.Z)(this,"selectedFileName",p.observable(null)),(0,l.Z)(this,"elemIdFileInput",p.observable("")),(0,l.Z)(this,"textButton",p.observable(null)),(0,l.Z)(this,"textLabel",p.observable(null)),(0,l.Z)(this,"textAllowedExt",p.observable(null)),(0,l.Z)(this,"isWaiting",p.observable(!1)),(0,l.Z)(this,"handleDrop",(function(e){e.preventDefault(),t.setFiles(e.dataTransfer.files)})),(0,l.Z)(this,"handleSubmit",(function(e){t.setFiles(e.target.files)})),(0,l.Z)(this,"deleteQueuedFile",(function(e){var i=t.queuedFileTransfers.find((function(t){return t.filename===e.fileName}));if(void 0===i)throw new Error("queued file transfer not found.");t.queuedFileTransfers.splice(t.queuedFileTransfers.indexOf(i),1),t.fileListItems.remove(e),t.isFileReadyForUpload(t.fileListItems().length>0),e.fileName===t.selectedFileName()&&t.selectedFileName(null)})),(0,l.Z)(this,"reset",(function(){t.queuedFileTransfers=[],t.fileListItems([]),t.selectedFileName(null),t.isFileReadyForUpload(!1),t.isWaiting(!1)})),(0,l.Z)(this,"uploadFile",(function(){var e=[];return 0===t.queuedFileTransfers.length?Promise.reject("Please select a file to upload."):(t.queuedFileTransfers.forEach((function(i){return e.push(t.configApi((n={},a=i,Object.assign(n,a))));var n,a})),t.isWaiting(!0),Promise.all(e).then((function(e){return e.forEach((function(e){return t.notifySuccess(e)}))})).catch((function(e){t.kp.publish("add-application-message",{type:"invalid",content:e}),t.isWaiting(!1)})).finally(t.reset))})),v++}var t,i;return(0,s.Z)(e,[{key:"preventDefaults",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"highlight",value:function(){this.elDropArea&&this.elDropArea.classList.add("file-upload__drop-area--is-dragover")}},{key:"unhighlight",value:function(){this.elDropArea&&this.elDropArea.classList.remove("file-upload__drop-area--is-dragover")}},{key:"validateFileSize",value:function(e){return null===this.configMaxFileSize||e.size<=this.configMaxFileSize}},{key:"validateFileExtension",value:function(e){return 0===this.configAllowedFileExtensions.length||-1!==this.configAllowedFileExtensions.indexOf(e.toLowerCase())}},{key:"validateFileNameIllegalChars",value:function(e){return!1===(0,c.$)(e.name)}},{key:"validateFileNameLength",value:function(e){return e.name.length<=120}},{key:"validateFileContent",value:function(e){var t=new FileReader;return new Promise((function(i,n){t.onloadend=function(e){var t=e.target.result,n=0;d().sanitize(t);for(var a=d().removed,l=0,s=g.length;l<s;l++)n+=(t.match(new RegExp(g[l],"gi"))||[]).length;i({isValid:0===a.length||a.length>0&&n===a.length,foundLength:Math.abs(a.length-n)})},t.onerror=function(){t.abort(),n("There was an error reading the file.")},t.readAsText(e)}))}},{key:"validate",value:(i=(0,a.Z)(u().mark((function e(t){var i,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==this.validateFileNameIllegalChars(t)){e.next=3;break}return this.notifyValidationFailuresFileName(t),e.abrupt("return",!1);case 3:if(i=this.getFileExtension(t),!1!==this.validateFileExtension(i)){e.next=7;break}return this.notifyValidationFailuresExtension(i),e.abrupt("return",!1);case 7:if(!1!==this.validateFileNameLength(t)){e.next=10;break}return this.notifyValidationFailuresFileNameLength(),e.abrupt("return",!1);case 10:if(!1!==this.validateFileSize(t)){e.next=13;break}return this.notifyValidationFailuresSizeLimit(t),e.abrupt("return",!1);case 13:if(!0!==this.configValidateContent||"text/plain"!==t.type){e.next=23;break}return e.next=16,this.validateFileContent(t);case 16:if(!1!==(n=e.sent).isValid){e.next=22;break}return this.notifyValidationFailuresContent(n.foundLength),e.abrupt("return",!1);case 22:this.notifyValidationSuccessContent();case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"notifyValidationFailuresSizeLimit",value:function(e){this.kp.publish("add-application-message",{type:"invalid",content:"File <strong>".concat(e.name,"</strong> exceeds the <strong>").concat(h(this.configMaxFileSize),"</strong> size limit and will not be uploaded."),isPersistant:!0})}},{key:"notifyValidationFailuresExtension",value:function(e){this.kp.publish("add-application-message",{type:"invalid",content:"File type <strong>".concat(e,"</strong> is not permitted, only <strong>").concat(this.configAllowedFileExtensions.join(", "),"</strong> are accepted."),isPersistant:!0})}},{key:"notifyValidationFailuresFileName",value:function(e){this.kp.publish("add-application-message",{type:"invalid",content:"Please rename file <strong>".concat(e.name,'</strong>. Filenames cannot contain <strong>\\ / : * ? " < > |</strong>'),isPersistant:!0})}},{key:"notifyValidationFailuresFileNameLength",value:function(){this.kp.publish("add-application-message",{type:"invalid",content:"File name cannot exceed <strong>".concat(120,"</strong> characters in length. Please shorten the file name."),isPersistant:!0})}},{key:"notifyValidationFailuresContent",value:function(e){this.kp.publish("add-application-message",{type:"invalid",content:"We have detected <strong>".concat(e," issue").concat(1===e?"":"s","</strong> with this file. Upload Blocked."),isPersistant:!0})}},{key:"notifyValidationSuccessContent",value:function(){this.kp.publish("add-application-message",{type:"valid",content:"Success. DOMPurify found 0 issues with this file"})}},{key:"getFileExtension",value:function(e){if("string"!=typeof e.name)throw new Error("fileName must be a string");var t=e.name,i=t.lastIndexOf(".");return-1===i?"":".".concat(t.substring(i+1,t.length))}},{key:"setFiles",value:(t=(0,a.Z)(u().mark((function e(t){var i,l=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return");case 2:i=!1===this.configMultiple?[t[0]]:(0,n.Z)(t),this.elFileInput&&(this.elFileInput.value=""),!1===this.configMultiple&&t.length>1&&this.kp.publish("add-application-message",{type:"information",content:"Only <strong>one file</strong> may be dropped at a time. <strong>".concat(i[0].name,"</strong> was accepted, the others have been removed.")}),i.forEach(function(){var e=(0,a.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.validate(t);case 2:if(e.t0=e.sent,!0!==e.t0){e.next=5;break}l.queueFileTransfers(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"queueFileTransfers",value:function(e){this.selectedFileName(e.name),!1===this.configMultiple?this.queuedFileTransfers=[new F(e)]:this.queuedFileTransfers.push(new F(e)),this.renderFileListItem(e),this.isFileReadyForUpload(!0)}},{key:"renderFileListItem",value:function(e){var t=this,i=new m(e);if(e.type.includes("image/")){var n=new FileReader;n.readAsDataURL(e),n.onloadend=function(e){i.src=e.target.result,!1===t.configMultiple?t.fileListItems([i]):t.fileListItems.push(i)}}else!1===this.configMultiple?this.fileListItems([i]):this.fileListItems.push(i)}},{key:"setDom",value:function(e){var t=this;if(null!==e){if(this.elDropArea=e.querySelector(".file-upload__drop-area"),this.elFileInput=e.querySelector(".file-upload__input-file"),null===this.elDropArea||null===!this.elFileInput)throw new Error("Elements required.");["dragenter","dragover","dragleave","drop"].forEach((function(e){t.elDropArea.addEventListener(e,t.preventDefaults,!1)})),["dragenter","dragover"].forEach((function(e){t.elDropArea.addEventListener(e,t.highlight,!1)})),["dragleave","drop"].forEach((function(e){t.elDropArea.addEventListener(e,t.unhighlight,!1)})),this.elDropArea.addEventListener("drop",this.handleDrop,!1),this.elDropArea.addEventListener("input",this.handleSubmit,!1),!0===this.configMultiple&&this.elFileInput.setAttribute("multiple","multiple"),this.configAllowedFileExtensions.length>0&&(this.allowedFileTypes=this.configAllowedFileExtensions.join(",")),this.elFileInput.setAttribute("accept","".concat(this.allowedFileTypes))}}},{key:"notifySuccess",value:function(e){this.kp.publish("add-application-message",{type:"valid",content:"File ".concat(e.filename," has been uploaded successfully")})}},{key:"initialize",value:function(e){this.configApi=e.endpoint,this.configMultiple=e.allowsMultiple,this.configMaxFileSize=e.maxFileSize,this.configValidateContent=e.validatePlainTextContent,this.configAllowedFileExtensions=e.allowedExtensions||[],this.textLabel(e.labelText),this.textButton(!0===this.configMultiple?"".concat(e.labelButton,"(s)"):e.labelButton),this.elemIdFileInput("file-elem-".concat(v)),this.configAllowedFileExtensions.length>0&&this.textAllowedExt("Accepted: ".concat(this.configAllowedFileExtensions.join(", "))),this.setDom(e.el)}}]),e}(),b=y}}]);
//# sourceMappingURL=fileUploader_js.bundle.js.map?ver=253e4d9df74607372e8c