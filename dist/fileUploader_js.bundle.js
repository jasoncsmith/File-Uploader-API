"use strict";(self.webpackChunkappLaunch=self.webpackChunkappLaunch||[]).push([[613],{717:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var i=n(209);function a(e){let t;for(t=0;e>=1024&&t<4;t++)e/=1024;return`${e.toFixed(1)}${["B","KB","MB","GB","TB"][t]}`}var l=n(856),s=n.n(l),o=n(527);const r=[],d=120;let u=0;function c(e){this.filename=e.name,this.totalfilesize=e.size,this.file=e}function f(e){this.fileName=e.name,this.src=null,this.size=a(e.size)}function p(){const e=o.postbox,t=this;let n=null,l=null,p=[],h="*",g=null,m=!1,b=null,v=!1,y=[];function F(e){e.preventDefault(),e.stopPropagation()}function w(){n.classList.add("file-upload__drop-area--is-dragover")}function L(){n.classList.remove("file-upload__drop-area--is-dragover")}function x(e){E(e.dataTransfer.files)}function $(e){E(e.target.files)}async function E(n){if(0===n.length)return;const o=!1===m?[n[0]]:[...n];l.value="",!1===m&&n.length>1&&e.publish("add-application-message",{type:"information",content:`Only <strong>one file</strong> may be dropped at a time. <strong>${o[0].name}</strong> was accepted, the others have been removed.`}),o.forEach((async n=>{var l;!0===await async function(t){if(!1===function({name:e}){return!1===(0,i.$t)(e)}(t))return function({name:t}){e.publish("add-application-message",{type:"invalid",content:`Please rename file <strong>${t}</strong>. Filenames cannot contain <strong>\\ / : * ? " < > |</strong>`,isPersistant:!0})}(t),!1;const n=function({name:e}){if("string"!=typeof e)throw new Error("fileName must be a string");const t=e,n=t.lastIndexOf(".");return-1===n?"":`.${t.substring(n+1,t.length)}`}(t);if(0==(l=n,0===y.length||-1!==y.indexOf(l.toLowerCase())))return function(t){e.publish("add-application-message",{type:"invalid",content:`File type <strong>${t}</strong> is not permitted, only <strong>${y.join(", ")}</strong> are accepted.`,isPersistant:!0})}(n),!1;var l,o;if(!1===function({name:e}){return e.length<=d}(t))return e.publish("add-application-message",{type:"invalid",content:`File name cannot exceed <strong>${d}</strong> characters in length. Please shorten the file name.`,isPersistant:!0}),!1;if(!1===function({size:e}){return null===b||e<=b}(t))return function({name:t}){e.publish("add-application-message",{type:"invalid",content:`File <strong>${t}</strong> exceeds the <strong>${a(b)}</strong> size limit and will not be uploaded.`,isPersistant:!0})}(t),!1;if(!0===v&&"text/plain"===t.type){const n=await function(e){const t=new FileReader,n=(0,i.RL)();return t.readAsText(e),t.onloadend=function(e){const t=e.target.result;let i=0;s().sanitize(t);const a=s().removed;for(let e=0,n=r.length;e<n;e++)i+=(t.match(new RegExp(r[e],"gi"))||[]).length;n.complete({isValid:0===a.length||a.length>0&&i===a.length,foundLength:Math.abs(a.length-i)})},n}(t);if(!1===n.isValid)return o=n.foundLength,e.publish("add-application-message",{type:"invalid",content:`We were not able to validate this file. We have detected <strong>${o} issue${1===o?"":"s"}</strong>. Please contact support.`,isPersistant:!0}),!1;e.publish("add-application-message",{type:"valid",content:"Success. DOMPurify found 0 issues with this file"})}return!0}(n)&&(l=n,t.selectedFileName(l.name),!1===m?p=[new c(l)]:p.push(new c(l)),function(e){const n=new f(e);if(e.type.includes("image/")){const i=new FileReader;i.readAsDataURL(e),i.onloadend=e=>{n.src=e.target.result,!1===m?t.fileListItems([n]):t.fileListItems.push(n)}}else!1===m?t.fileListItems([n]):t.fileListItems.push(n)}(l),t.isFileReadyForUpload(!0))}))}function P(t){e.publish("add-application-message",{type:"valid",content:`File ${t.filename} has been uploaded successfully`})}u++,t.fileListItems=o.observableArray([]),t.isFileReadyForUpload=o.observable(null).extend({notify:"always"}),t.selectedFileName=o.observable(null),t.elemIdFileInput=o.observable(""),t.textButton=o.observable(null),t.textLabel=o.observable(null),t.textAllowedExt=o.observable(null),t.isWaiting=o.observable(!1),this.deleteQueuedFile=function(e){const n=p.find((t=>t.filename===e.fileName));if(void 0===n)throw new Error("queued file transfer not found.");p.splice(p.indexOf(n),1),t.fileListItems.remove(e),t.isFileReadyForUpload(t.fileListItems().length>0),e.fileName===t.selectedFileName()&&t.selectedFileName(null)},this.reset=function(){p=[],t.fileListItems([]),t.selectedFileName(null),t.isFileReadyForUpload(!1),t.isWaiting(!1)},this.uploadFile=function(n){n=n||{};const i=[];return 0===p.length?Promise.reject("Please select a file to upload."):(p.forEach((e=>{return i.push(g((t={},n=e,Object.assign(t,n))));var t,n})),t.isWaiting(!0),Promise.all(i).then((e=>e.forEach(P))).catch((n=>{e.publish("add-application-message",{type:"invalid",content:n}),t.isWaiting(!1)})).finally(t.reset))},this.initialize=function({el:e,endpoint:i,allowsMultiple:a,allowedExtensions:s,maxFileSize:o,labelText:r,labelButton:d,validatePlainTextContent:c}){g=i,m=a,b=o,v=c,y=s||[],t.textLabel(r),t.textButton(!0===m?`${d}(s)`:d),t.elemIdFileInput(`file-elem-${u}`),y.length>0&&t.textAllowedExt(`Accepted: ${y.join(", ")}`),function(e){n=e.querySelector(".file-upload__drop-area"),l=e.querySelector(".file-upload__input-file"),["dragenter","dragover","dragleave","drop"].forEach((e=>{n.addEventListener(e,F,!1)})),["dragenter","dragover"].forEach((e=>{n.addEventListener(e,w,!1)})),["dragleave","drop"].forEach((e=>{n.addEventListener(e,L,!1)})),n.addEventListener("drop",x,!1),n.addEventListener("input",$,!1),!0===m&&l.setAttribute("multiple","multiple"),y.length>0&&(h=y.join(",")),l.setAttribute("accept",`${h}`)}(e)}}}}]);
//# sourceMappingURL=fileUploader_js.bundle.js.map?ver=641c288b3a1d4c5e910f